{{$prefix := (index .Vars "prefix")}}
import (
	"context"

	"go.uber.org/yarpc"

	"github.com/uber/cadence/common/types"
	"github.com/uber/cadence/common/types/mapper/thrift"
)

{{$interfaceName := .Interface.Name}}
{{$clientName := (index .Vars "client")}}
{{ $decorator := (printf "%s%s" (down $clientName) .Interface.Name) }}

{{range $method := .Interface.Methods}}
	{{$Request := printf "%sRequest" $method.Name}}
	{{$Response := printf "%sResponse" $method.Name}}
	func (g {{$decorator}}) {{$method.Declaration}} {
		{{- if eq $method.Name "CountDLQMessages" "RatelimitStartup" "RatelimitUpdate"}}
			return nil, thrift.ToError(&types.BadRequestError{Message: "Feature not supported on TChannel"})
		{{- else}}
			{{- if eq (len $method.Params) 2}}
				{{- /* func(ctx, opts...) ? */}}
				{{- if eq (len $method.Results) 1}}
					{{- /* func(ctx, opts...) error */}}
					{{(index $method.Results 0).Name}} = g.c.{{$method.Call}}
				{{- else}}
					{{- /* func(ctx, opts...) (result, error) */}}
					response, {{(index $method.Results 1).Name}} := g.c.{{$method.Call}}
				{{- end}}
			{{- else}}
				{{- /* func(ctx, arg, opts...) ? */}}
				{{- if eq (len $method.Results) 1}}
					{{- /* func(ctx, opts...) error */}}
					{{(index $method.Results 0).Name}} = g.c.{{$method.Name}}({{(index $method.Params 0).Name}}, thrift.From{{$prefix}}{{$Request}}({{(index $method.Params 1).Name}}), {{(index $method.Params 2).Pass}})
				{{- else}}
					{{- /* func(ctx, arg, opts...) (result, error) */}}
					response, {{(index $method.Results 1).Name}} := g.c.{{$method.Name}}({{(index $method.Params 0).Name}}, thrift.From{{$prefix}}{{$Request}}({{(index $method.Params 1).Name}}), {{(index $method.Params 2).Pass}})
				{{- end}}
			{{- end}}

			{{- if eq (len $method.Results) 1}}
				return thrift.ToError({{(index $method.Results 0).Name}})
			{{- else}}
				return thrift.To{{$prefix}}{{$Response}}(response), thrift.ToError({{(index $method.Results 1).Name}})
			{{- end}}
		{{- end}}
	}
{{end}}
